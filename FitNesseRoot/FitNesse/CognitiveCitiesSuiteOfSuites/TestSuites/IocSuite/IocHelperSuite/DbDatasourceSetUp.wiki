---
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables


'''CREATE DATABASE TYPE DATASOURCES'''


'''Create database table for the data source'''

| generic database fixture |
| # comment | connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |
| Create source database table | iocdb | create | CREATE TABLE ioc.ds_source_table (ID INTEGER NOT NULL, NAME VARCHAR(128) NOT NULL, STARTDATETIME TIMESTAMP, LOCATION VARCHAR(500), LASTCHANGED TIMESTAMP) ORGANIZE BY ROW DATA CAPTURE NONE IN USERSPACE1 | |  | | OK |
| Insert first record | iocdb | create | insert into ioc.ds_source_table values (1,'NAME1','2019-04-01 12:00:00.0','POINT(-97.69575 30.590381)','2019-04-03 12:00:00.0') | |  | | OK |
| Insert second record | iocdb | create | insert into ioc.ds_source_table values (2,'NAME2','2019-04-02 13:00:00.0','POINT(-97.69675 30.590481)','2019-04-03 13:00:00.0') | |  | | OK |
| Verify the records were created | iocdb | read | select count as count from ioc.ds_source_table | json | [{"COUNT":2}] | 1 | OK |

'''Create database type data source '''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name":"db_table_test", "lastUpdateDate":1554313063683, "messages":[ { "messageId":"CIYRS0008I", "messageText":"{\"key\":\"CIYRS0008I\",\"group\":\"DataSourceApp\"}", "i18nMessageText":"The data source Database Table Test was saved." } ], "type":"Database", "scope":"DATASOURCE", "label":{ "group":"DataSourceI18n", "key":"i18n_f747fdee-5b74-4534-8786-ae97a3e1a43e", "resources":[ { "group":"DataSourceI18n", "locale":"en", "key":"i18n_f747fdee-5b74-4534-8786-ae97a3e1a43e", "value":"Database Table Test" } ] }, "i18nLabel":"Database Table Test", "description":{ "group":"DataSourceI18n", "key":"i18n_d565a122-1b46-48db-8651-c370f6967137", "resources":[ { "group":"DataSourceI18n", "locale":"en", "key":"i18n_d565a122-1b46-48db-8651-c370f6967137", "value":"" } ] }, "receiver":{ "type":"com.ibm.ioc.datareceiver.types.DataReceiverTable", "interval":1, "unit":"MINUTES", "started":true, "skippedColumns":[ ] }, "source":{ "protocol":"ioc.datasource.ColumnParserDatabase", "options":"DB2", "host":"dubperfwow2-db.mul.ie.ibm.com", "port":50000, "user":"db2i1own", "password":"us3rpa88", "directory":"iocdb", "filename":"ioc.ds_source_table" }, "columns":[ { "type":"INTEGER", "sourceType":"INTEGER", "sourceName":"ID", "hint":"ID", "label":{ "group":"DataSourceI18n", "key":"i18n_a9128b9b-455f-47df-a17c-a3398db4ab30", "i18nLabel":"ID", "resources":[ { "id":83315, "lastUpdateDate":1554313063902, "group":"DataSourceI18n", "locale":"en", "key":"i18n_a9128b9b-455f-47df-a17c-a3398db4ab30", "value":"ID" } ] }, "category":"KEY", "length":"10", "scale":"0", "enumerated":false, "isId":true, "optimize":true, "updatable":false, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"i18n_65345362-d788-493a-9c5f-c5a2f704b7e1", "i18nLabel":"", "resources":[ { "id":83316, "lastUpdateDate":1554313063905, "group":"DataSourceI18n", "locale":"en", "key":"i18n_65345362-d788-493a-9c5f-c5a2f704b7e1", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false, "targetNames":[ "Property_ID" ] }, { "type":"TIMESTAMP", "sourceType":"TIMESTAMP", "sourceName":"LASTCHANGED", "hint":"LASTCHANGED", "label":{ "group":"DataSourceI18n", "key":"i18n_e22f189e-0dd6-4553-a853-be2a8400b43c", "i18nLabel":"LASTCHANGED", "resources":[ { "id":83323, "lastUpdateDate":1554313063928, "group":"DataSourceI18n", "locale":"en", "key":"i18n_e22f189e-0dd6-4553-a853-be2a8400b43c", "value":"LASTCHANGED" } ] }, "category":"MINIMAL", "length":"26", "scale":"6", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"i18n_2400baef-9fbc-4890-b0eb-6304e55085d2", "i18nLabel":"", "resources":[ { "id":83324, "lastUpdateDate":1554313063932, "group":"DataSourceI18n", "locale":"en", "key":"i18n_2400baef-9fbc-4890-b0eb-6304e55085d2", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false, "targetNames":[ "LAST_UPDATE_DATE_TIME" ], "format":"TIMESTAMP" }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"LOCATION", "hint":"LOCATION", "label":{ "group":"DataSourceI18n", "key":"i18n_54913dd7-eaed-478b-84d8-19836f1d2296", "i18nLabel":"LOCATION", "resources":[ { "id":83321, "lastUpdateDate":1554313063921, "group":"DataSourceI18n", "locale":"en", "key":"i18n_54913dd7-eaed-478b-84d8-19836f1d2296", "value":"LOCATION" } ] }, "category":"MINIMAL", "length":"500", "scale":"0", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"i18n_76d7a203-16af-413f-873b-ac9cca8ad5bf", "i18nLabel":"", "resources":[ { "id":83322, "lastUpdateDate":1554313063925, "group":"DataSourceI18n", "locale":"en", "key":"i18n_76d7a203-16af-413f-873b-ac9cca8ad5bf", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false, "targetNames":[ "LOCATION" ], "format":"SHAPE", "lookup":{ "directory":"", "filename":"" } }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"NAME", "hint":"NAME", "label":{ "group":"DataSourceI18n", "key":"i18n_414cf357-3c77-4d70-b60c-9d757c939a1b", "i18nLabel":"NAME", "resources":[ { "id":83317, "lastUpdateDate":1554313063909, "group":"DataSourceI18n", "locale":"en", "key":"i18n_414cf357-3c77-4d70-b60c-9d757c939a1b", "value":"NAME" } ] }, "category":"MINIMAL", "length":"128", "scale":"0", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"i18n_d400529c-b6e0-413f-8cf4-e4468d62f8ba", "i18nLabel":"", "resources":[ { "id":83318, "lastUpdateDate":1554313063912, "group":"DataSourceI18n", "locale":"en", "key":"i18n_d400529c-b6e0-413f-8cf4-e4468d62f8ba", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false, "targetNames":[ "NAME" ], "format":"STRING" }, { "type":"TIMESTAMP", "sourceType":"TIMESTAMP", "sourceName":"STARTDATETIME", "hint":"STARTDATETIME", "label":{ "group":"DataSourceI18n", "key":"i18n_94f02c05-ab39-4d14-a10e-d30f02b2f888", "i18nLabel":"STARTDATETIME", "resources":[ { "id":83319, "lastUpdateDate":1554313063915, "group":"DataSourceI18n", "locale":"en", "key":"i18n_94f02c05-ab39-4d14-a10e-d30f02b2f888", "value":"STARTDATETIME" } ] }, "category":"MINIMAL", "length":"26", "scale":"6", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"i18n_a58fbc7f-dee7-4adc-807d-1339553775b9", "i18nLabel":"", "resources":[ { "id":83320, "lastUpdateDate":1554313063918, "group":"DataSourceI18n", "locale":"en", "key":"i18n_a58fbc7f-dee7-4adc-807d-1339553775b9", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false, "targetNames":[ "START_DATE_TIME" ], "format":"TIMESTAMP" } ], "geometry":"POINT", "archive":0, "boundary":false, "boundaryFilterPane":false, "correlation":false, "report":false, "serverRendering":false, "nonTrustedSource":false, "comments":false, "voting":false, "imageUploads":false, "icon":"311.png", "radius":0, "sides":0, "styles":[ { "name":"_base_", "type":"COLOR", "line":"#000000", "value":"#d3d3d3", "weight":1, "opacity":1, "scope":"DATASOURCE" } ], "extensions":[ { "name":"category", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"1" }, { "name":"dimension", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" }, { "name":"name", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"db_table_test" }, { "name":"resource", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" } ], "customProperties":{ }, "optionalDateTime":false, "minZoomForLoad":0, "dateFormat":"", "timeFormat":"", "areas":"", "routingLogic":"AND", "rules":[ ]} | | 200 | | $DSID_DB= || |
| GET | /datasource-service/datasources/$DSID_DB | | | 200 | =~/(?i)"name":"db_table_test"/ | | 1 | |

|script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|#''Give data receiver time to receive records''|
|time delay ;|5000|

'''Verify the target table has two records'''

| generic database fixture |
| # comment | connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |
| Verify the target table has two records | iocdata | read | select count as count from ioc.target_table_db_table_test | json | [{"COUNT":2}] | 1 | OK |
