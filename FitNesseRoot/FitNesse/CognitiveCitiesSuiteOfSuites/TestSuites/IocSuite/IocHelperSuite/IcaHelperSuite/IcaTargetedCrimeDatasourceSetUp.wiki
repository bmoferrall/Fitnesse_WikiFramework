---
Help: Create ICA Targeted Crime Datasource
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables

'''CREATE TARGETED CRIME DATASOURCE'''

'''Copy source zip to app server and unzip'''

| script |
| remote file copy; | ./testfiles/ica/crimes_targeted.zip | /opt/IBM/ioc/csv/crimes_targeted.zip | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |
| remote command execution; | cd /opt/IBM/ioc/csv;unzip -o crimes_targeted.zip;rm -f crimes_targeted.zip | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |

'''Create i18n resources for the data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_DsLabel", "value":"Crime - Targeted (Fitnesse)","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_OBJECTID", "value":"OBJECTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_CASEID", "value":"CASE_ID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_LONGITUDE", "value":"LONGITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_LATITUDE", "value":"LATITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_TYPE", "value":"TYPE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_BLOCKID", "value":"BLOCKID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_AREA_ID", "value":"AREA_ID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_DISTRICTID", "value":"DISTRICTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_C_DISTRICTID", "value":"C_DISTRICTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_NBHD_CODE", "value":"NBHD_CODE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_NBHD_NAME", "value":"NBHD_NAME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_ZONEID", "value":"ZONEID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_NATURECODE", "value":"NATURECODE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_SECTOR", "value":"SECTOR","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_NBR", "value":"NBR","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_STREET", "value":"STREET","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_DIS", "value":"DIS","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_ZONE", "value":"ZONE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_SHIFT", "value":"SHIFT","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_DISPNOTES", "value":"DISPNOTES","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICATargetedCrime_Fitnesse_START_TIMESTAMP", "value":"START_TIMESTAMP","messages": []}|||||||

'''Create CSV type data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name": "${DS_NAME_ICA_CRIMETARG}", "type": "CSV", "scope": "DATASOURCE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_DsLabel", "i18nLabel": "Crime - Targeted (Fitnesse)" }, "i18nLabel": "Crime - Targeted (Fitnesse)", "description": { "group": "Fitnesse", "key": "i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31", "i18nLabel": "i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31" }, "receiver": { "type": "com.ibm.ioc.datareceiver.types.DataReceiverCSV", "interval": 1, "unit": "MINUTES", "started": true }, "source": { "protocol": "com.ibm.ioc.datasource.ColumnParserCsv", "port": 0, "directory": "/opt/IBM/ioc/csv/", "filename": "${CSV_NAME_ICA_CRIMETARG}", "persistData": true }, "columns": [ { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "0", "targetNames": [ "Property_OBJECTID" ], "hint": "OBJECTID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_OBJECTID", "i18nLabel": "OBJECTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_9c21a16e-ee7c-4a19-8c68-a0b40b75811b", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "1", "targetNames": [ "CASE_ID" ], "hint": "CASE_ID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_CASEID", "i18nLabel": "CASE_ID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_2c43a90a-7682-4c36-9997-37ff116cd706", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "10", "targetNames": [ "LONGITUDE" ], "hint": "LONGITUDE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_LONGITUDE", "i18nLabel": "LONGITUDE" }, "category": "MINIMAL", "format": "LAT_LON", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_a6fb920e-2c9a-4001-a30b-6814cc3b89cf", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "11", "targetNames": [ "LATITUDE" ], "hint": "LATITUDE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_LATITUDE", "i18nLabel": "LATITUDE" }, "category": "MINIMAL", "format": "LAT_LON", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_5dfa74d3-9462-4c1d-83ca-1113471c6f0d", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "12", "targetNames": [ "NAME" ], "hint": "TYPE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_TYPE", "i18nLabel": "TYPE" }, "category": "MINIMAL", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_903ca59b-fa55-4124-a73a-3f326151718e", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "13", "targetNames": [ "BLOCKID" ], "hint": "BLOCKID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_BLOCKID", "i18nLabel": "BLOCKID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_4724bc98-fb14-4afa-9ddc-f36ddc252bd9", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "14", "targetNames": [ "AREA_ID" ], "hint": "AREA_ID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_AREA_ID", "i18nLabel": "AREA_ID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_95c5a5f7-5c65-4042-b87f-d85640bcd5d0", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "15", "targetNames": [ "DISTRICTID" ], "hint": "DISTRICTID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_DISTRICTID", "i18nLabel": "DISTRICTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_bbd1abe4-e51b-44d9-99c2-99e44b78de67", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "16", "targetNames": [ "C_DISTRICTID" ], "hint": "C_DISTRICTID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_C_DISTRICTID", "i18nLabel": "C_DISTRICTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_6db9d24d-49f9-4af0-b532-927624c30bc4", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "17", "targetNames": [ "NBHD_CODE" ], "hint": "NBHD_CODE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_NBHD_CODE", "i18nLabel": "NBHD_CODE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_a7d7459a-456a-4f07-9f0e-0ffcfa01cc2d", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "18", "targetNames": [ "NBHD_NAME" ], "hint": "NBHD_NAME", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_NBHD_NAME", "i18nLabel": "NBHD_NAME" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_277ee5ad-70a2-41f1-ac62-c3443b79af60", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "19", "targetNames": [ "ZONEID" ], "hint": "ZONEID", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_ZONEID", "i18nLabel": "ZONEID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_8747ad16-dba3-4c67-a9cc-95ebbaa63c39", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "2", "targetNames": [ "NATURECODE" ], "hint": "NATURECODE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_NATURECODE", "i18nLabel": "NATURECODE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_7da90a97-5286-4c19-9fa5-da6daabfe52c", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "20", "targetNames": [ "SECTOR" ], "hint": "SECTOR", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_SECTOR", "i18nLabel": "SECTOR" }, "category": "KEY", "length": "200", "enumerated": true, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_09b219eb-aca3-46de-babd-d481b56e07ad", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "3", "targetNames": [ "NBR" ], "hint": "NBR", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_NBR", "i18nLabel": "NBR" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_aea3a5ad-e5a3-4c8f-a0ec-6c3a53449ad4", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "4", "targetNames": [ "STREET" ], "hint": "STREET", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_STREET", "i18nLabel": "STREET" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_1aa9bec3-02b4-443b-9069-8553d85e12fe", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "5", "targetNames": [ "DIS" ], "hint": "DIS", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_DIS", "i18nLabel": "DIS" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_0def5bdf-2361-4af4-a898-caa6c8154a3f", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "6", "targetNames": [ "ZONE" ], "hint": "ZONE", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_ZONE", "i18nLabel": "ZONE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_f8606c13-befb-4477-9c73-d4dac2ea4977", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "7", "targetNames": [ "SHIFT" ], "hint": "SHIFT", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_SHIFT", "i18nLabel": "SHIFT" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_ac1d7c77-c013-4bf1-b48a-f9f142ed6d20", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "8", "targetNames": [ "DISPNOTES" ], "hint": "DISPNOTES", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_DISPNOTES", "i18nLabel": "DISPNOTES" }, "category": "FULL", "length": "1024", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_7b333f11-1943-49e3-9cdd-4cda24523ab5", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "TIMESTAMP", "sourceType": "VARCHAR", "sourceName": "9", "targetNames": [ "START_DATE_TIME", "END_DATE_TIME" ], "hint": "START_TIMESTAMP", "label": { "group": "Fitnesse", "key": "ICATargetedCrime_Fitnesse_START_TIMESTAMP", "i18nLabel": "START_TIMESTAMP" }, "category": "MINIMAL", "format": "TIMESTAMP", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_d41f615c-45e9-49ed-a0a8-503121a3f9bd", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false } ], "geometry": "POINT", "routingLogic": "AND", "styleLogic": "AND", "archive": 1, "boundary": false, "boundaryFilterPane": false, "correlation": false, "report": false, "table": "IOC.TARGET_TABLE_${TT_NAME_ICA_CRIMETARG}", "view": "IOC.TARGET_VIEW_${TT_NAME_ICA_CRIMETARG}", "serverRendering": false, "nonTrustedSource": false, "comments": false, "voting": false, "imageUploads": false, "icon": "disturbance.png", "radius": 0, "sides": 0, "styles": [ { "name": "_base_", "label": {}, "type": "COLOR", "line": "#000000", "value": "#d3d3d3", "weight": 1, "opacity": 1, "scope": "DATASOURCE" } ], "extensions": [ { "name": "category", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "1" }, { "name": "dimension", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" }, { "name": "name", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "crime_targ_ica" }, { "name": "resource", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" } ], "optionalDateTime": false, "minZoomForLoad": 0 } | | 200 | | $DSID_ICACRIMETARG= | | |
| GET | /datasource-service/datasources/$DSID_ICACRIMETARG | | | 200 | =~/(?i)"Name":"${DS_NAME_ICA_CRIMETARG}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 120000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |getFirstResultField?|
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_ICA_CRIMETARG} | json | [{"COUNT":63409}] | 1 | OK |63409|
