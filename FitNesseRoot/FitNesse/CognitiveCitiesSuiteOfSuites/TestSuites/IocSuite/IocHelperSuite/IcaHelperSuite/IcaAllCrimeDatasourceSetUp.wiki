---
Help: Create ICA All Crime Datasource
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables

'''CREATE ALL CRIME DATASOURCE'''

'''Copy source zip to app server and unzip'''

| script |
| remote file copy; | ./testfiles/ica/crimes_all.zip | /opt/IBM/ioc/csv/crimes_all.zip | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |
| remote command execution; | cd /opt/IBM/ioc/csv;unzip -o crimes_all.zip;rm -f crimes_all.zip | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |

'''Create i18n resources for data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_DsLabel", "value":"Crime - All (Fitnesse)","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_OBJECTID", "value":"OBJECTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_INCI_ID", "value":"INCI_ID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_LATITUDE", "value":"LATITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NATURE_CODE", "value":"NATURE_CODE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_TYPE", "value":"TYPE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_BLOCKID", "value":"BLOCKID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_AREA_ID", "value":"AREA_ID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_DISTRICTID", "value":"DISTRICTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_C_DISTRICTID", "value":"C_DISTRICTID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_CODE", "value":"NBHD_CODE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_NAME", "value":"NBHD_NAME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_ZONEID", "value":"ZONEID","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_OFFENSE", "value":"OFFENSE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_SECTOR", "value":"SECTOR","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_STREETNBR", "value":"STREETNBR","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_NBHD_STREET", "value":"STREET","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_ZONE", "value":"ZONE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_DISTRICT", "value":"DISTRICT","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_EMSHIFT", "value":"EMSHIFT","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_START_TIMESTAMP", "value":"START_TIMESTAMP","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"ICAAllCrime_Fitnesse_LONGITUDE", "value":"LONGITUDE","messages": []}|||||||

'''Create CSV type data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name": "${DS_NAME_ICA_CRIMEALL}", "type": "CSV", "scope": "DATASOURCE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_DsLabel", "i18nLabel": "Crime - All (Fitnesse)" }, "i18nLabel": "Crime - All (Fitnesse)", "description": { "group": "Fitnesse", "key": "i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31", "i18nLabel": "" }, "receiver": { "type": "com.ibm.ioc.datareceiver.types.DataReceiverCSV", "interval": 1, "unit": "MINUTES", "started": true }, "source": { "protocol": "com.ibm.ioc.datasource.ColumnParserCsv", "port": 0, "directory": "/opt/IBM/ioc/csv/", "filename": "${CSV_NAME_ICA_CRIMEALL}", "persistData": true }, "columns": [ { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "0", "targetNames": [ "Property_OBJECTID" ], "hint": "OBJECTID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_OBJECTID", "i18nLabel": "OBJECTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_5bf6afdb-80e1-440a-8ca2-fd6bfbe8561f", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "1", "targetNames": [ "INCI_ID" ], "hint": "INCI_ID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_INCI_ID", "i18nLabel": "INCI_ID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_7d6daaf7-4553-42cf-9917-addc3ebbfa22", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "10", "targetNames": [ "LATITUDE" ], "hint": "LATITUDE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_LATITUDE", "i18nLabel": "LATITUDE" }, "category": "MINIMAL", "format": "LAT_LON", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_69a3eab0-f6b0-4394-8e31-264cbc2bdf10", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "11", "targetNames": [ "NATURECODE" ], "hint": "NATURE_CODE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NATURE_CODE", "i18nLabel": "NATURE_CODE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_16ee74ca-67d6-4348-861f-aafe7a2d829c", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "12", "targetNames": [ "NAME" ], "hint": "TYPE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_TYPE", "i18nLabel": "TYPE" }, "category": "MINIMAL", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_4d6d363f-636c-4c1b-8ce2-4185166cc5c9", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "13", "targetNames": [ "BLOCKID" ], "hint": "BLOCKID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_BLOCKID", "i18nLabel": "BLOCKID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_322edfff-a432-4c71-8ae7-31288229409f", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "14", "targetNames": [ "AREA_ID" ], "hint": "AREA_ID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_AREA_ID", "i18nLabel": "AREA_ID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_31285817-585e-4cf6-b521-680041f9ea3d", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "15", "targetNames": [ "DISTRICTID" ], "hint": "DISTRICTID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_DISTRICTID", "i18nLabel": "DISTRICTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_439e812f-576a-433c-b583-970f3a08d67d", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "16", "targetNames": [ "C_DISTRICTID" ], "hint": "C_DISTRICTID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_C_DISTRICTID", "i18nLabel": "C_DISTRICTID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_f3eb603e-40ae-4e8d-bbd9-ac9489d3c183", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "17", "targetNames": [ "NBHD_CODE" ], "hint": "NBHD_CODE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_CODE", "i18nLabel": "NBHD_CODE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_03619b12-42d0-4f38-a653-d40f884a22e7", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "18", "targetNames": [ "NBHD_NAME" ], "hint": "NBHD_NAME", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_NAME", "i18nLabel": "NBHD_NAME" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_838d628e-eb45-4514-92a5-9de56aaca793", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "19", "targetNames": [ "ZONEID" ], "hint": "ZONEID", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_ZONEID", "i18nLabel": "ZONEID" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_3e20e859-49a5-4e28-b781-ffc5f05a2f0a", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "2", "targetNames": [ "OFFENSE" ], "hint": "OFFENSE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_OFFENSE", "i18nLabel": "OFFENSE" }, "category": "KEY", "length": "200", "enumerated": true, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_b1b437ff-befe-4a61-a4df-303ff97cd1f7", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "20", "targetNames": [ "SECTOR" ], "hint": "SECTOR", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_SECTOR", "i18nLabel": "SECTOR" }, "category": "KEY", "length": "200", "enumerated": true, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_2da4cda2-dbcd-4429-80e5-79dbc6b7a2ed", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "3", "targetNames": [ "STREETNBR" ], "hint": "STREETNBR", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_STREETNBR", "i18nLabel": "STREETNBR" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_b1474210-ee6e-4b7b-841c-78c9c248c864", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "4", "targetNames": [ "STREET" ], "hint": "STREET", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_NBHD_STREET", "i18nLabel": "STREET" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_93e4c50b-52b6-436d-b229-16b438958b30", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "5", "targetNames": [ "ZONE" ], "hint": "ZONE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_ZONE", "i18nLabel": "ZONE" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_61861c6c-af27-4e56-95fa-1a36c1eb5bb0", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "6", "targetNames": [ "DISTRICT" ], "hint": "DISTRICT", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_DISTRICT", "i18nLabel": "DISTRICT" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_21a1be7b-04b3-42c0-9093-a95e494e0867", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "7", "targetNames": [ "EMSHIFT" ], "hint": "EMSHIFT", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_EMSHIFT", "i18nLabel": "EMSHIFT" }, "category": "FULL", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_65482041-7536-436d-bbf6-fbbaff9a8bab", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "TIMESTAMP", "sourceType": "VARCHAR", "sourceName": "8", "targetNames": [ "START_DATE_TIME", "END_DATE_TIME" ], "hint": "START_TIMESTAMP", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_START_TIMESTAMP", "i18nLabel": "START_TIMESTAMP" }, "category": "MINIMAL", "format": "TIMESTAMP", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_38a4d41d-a6f5-405e-8ef8-138ec34c54b5", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "9", "targetNames": [ "LONGITUDE" ], "hint": "LONGITUDE", "label": { "group": "Fitnesse", "key": "ICAAllCrime_Fitnesse_LONGITUDE", "i18nLabel": "LONGITUDE" }, "category": "MINIMAL", "format": "LAT_LON", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_51268f16-59cc-4d67-a2ef-0f17df429c2e", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false } ], "geometry": "POINT", "routingLogic": "AND", "styleLogic": "AND", "archive": 1, "boundary": false, "boundaryFilterPane": false, "correlation": false, "report": false, "table": "IOC.TARGET_TABLE_${CSV_NAME_ICA_CRIMEALL}", "view": "IOC.TARGET_VIEW_${CSV_NAME_ICA_CRIMEALL}", "serverRendering": false, "nonTrustedSource": false, "comments": false, "voting": false, "imageUploads": false, "icon": "disturbance.png", "radius": 0, "sides": 0, "styles": [ { "name": "_base_", "label": {}, "type": "COLOR", "line": "#000000", "value": "#d3d3d3", "weight": 1, "opacity": 1, "scope": "DATASOURCE" } ], "extensions": [ { "name": "category", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "1" }, { "name": "dimension", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" }, { "name": "name", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "crime_all_ica" }, { "name": "resource", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" } ], "optionalDateTime": false, "minZoomForLoad": 0 } | | 200 | | $DSID_ICACRIMEALL= | | |
| GET | /datasource-service/datasources/$DSID_ICACRIMEALL | | | 200 | =~/(?i)"Name":"${DS_NAME_ICA_CRIMEALL}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 600000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |getFirstResultField?|
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_ICA_CRIMEALL} | json | [{"COUNT":395700}] | 1 | OK |395700|
