---
Help: Create ICA Weather Datasource
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar
'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables
'''Create i18n resources for the data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_DsLabel", "value":"Weather (Fitnesse)","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_AvgTemperature", "value":"AvgTemperature","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_Datatype", "value":"Datatype","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_Location", "value":"Location","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_MaxTemperature", "value":"MaxTemperature","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_MinTemperature", "value":"MinTemperature","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_Precipitation", "value":"Precipitation","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_Snow", "value":"Snow","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_StationId", "value":"StationId","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_TimeZoneOffset", "value":"TimeZoneOffset","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_end_time", "value":"end_time","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_start_time", "value":"start_time","messages": []} | | | | | | |
| POST | /i18n-service/resources | {"group": "Fitnesse", "locale":"en", "key":"ICAWeather_Fitnesse_update_time", "value":"update_time","messages": []} | | | | | | |

'''CREATE WEATHER DATASOURCE'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name": "${DS_NAME_ICA_WEATHER}", "type": "ICA_Weather", "scope": "DATASOURCE", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_DsLabel", "i18nLabel": "Weather (Fitnesse)" }, "i18nLabel": "Weather (Fitnesse)", "description": {}, "receiver": { "type": "com.ibm.iss.cros.datareceiver.types.DataReceiverWeather", "interval": 1, "unit": "DAYS", "started": true }, "source": { "protocol": "com.ibm.iss.cros.datasource.ColumnParserWeather", "options": "USC00083163", "host": "{\"lat\":\"26.1019\",\"lon\":\"-80.2011\",\"units\":\"US\"}", "port": 0, "user": "America/New_York", "directory": "FLORIDA", "filename": "FT LAUDERDALE", "persistData": true }, "columns": [ { "type": "DOUBLE", "sourceType": "DOUBLE", "sourceName": "AvgTemperature", "targetNames": [ "TAVG" ], "hint": "AvgTemperature", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_AvgTemperature", "i18nLabel": "AvgTemperature" }, "category": "KEY", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_40a4e811-742c-4bc8-9fe5-f631b765b6dc", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "STRING", "sourceName": "Datatype", "targetNames": [ "DATATYPE" ], "hint": "Datatype", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_Datatype", "i18nLabel": "Datatype" }, "category": "KEY", "format": "STRING", "length": "200", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_69ffbaf9-9a04-4f32-a6aa-07c302c5f226", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "Location", "targetNames": [ "LOCATION" ], "hint": "Location", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_Location", "i18nLabel": "Location" }, "category": "MINIMAL", "format": "SHAPE", "enumerated": false, "isId": false, "optimize": true, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_4bd6e0db-d987-4222-9a75-684611ec2052", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "DOUBLE", "sourceType": "DOUBLE", "sourceName": "MaxTemperature", "targetNames": [ "TMAX" ], "hint": "MaxTemperature", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_MaxTemperature", "i18nLabel": "MaxTemperature" }, "category": "KEY", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_d912cb42-c33a-42db-9f18-fa8008ac991a", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "DOUBLE", "sourceType": "DOUBLE", "sourceName": "MinTemperature", "targetNames": [ "TMIN" ], "hint": "MinTemperature", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_MinTemperature", "i18nLabel": "MinTemperature" }, "category": "KEY", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_f584af83-c0a3-44b2-a7ea-972f86a2d697", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "DOUBLE", "sourceType": "DOUBLE", "sourceName": "Precipitation", "targetNames": [ "PRCP" ], "hint": "Precipitation", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_Precipitation", "i18nLabel": "Precipitation" }, "category": "KEY", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_4894074c-5369-4d1c-8ab8-d6e6d1f7a2ae", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "DOUBLE", "sourceType": "DOUBLE", "sourceName": "Snow", "targetNames": [ "SNOW" ], "hint": "Snow", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_Snow", "i18nLabel": "Snow" }, "category": "KEY", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_08185c27-5c73-4567-9c44-11dc0985a9f8", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "VARCHAR", "sourceType": "VARCHAR", "sourceName": "StationId", "targetNames": [ "NAME" ], "hint": "StationId", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_StationId", "i18nLabel": "StationId" }, "category": "MINIMAL", "format": "STRING", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_c8de14f9-0cba-4562-8e2c-406dd959f614", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "INTEGER", "sourceType": "INTEGER", "sourceName": "TimeZoneOffset", "targetNames": [ "TIMEZONE_OFFSET" ], "hint": "TimeZoneOffset", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_TimeZoneOffset", "i18nLabel": "TimeZoneOffset" }, "category": "MINIMAL", "format": "INTEGER", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_e4dbb47c-d41a-4e90-b1c7-50cb81af8700", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "TIMESTAMP", "sourceType": "TIMESTAMP", "sourceName": "end_time", "targetNames": [ "END_DATE_TIME" ], "hint": "end_time", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_end_time", "i18nLabel": "end_time" }, "category": "MINIMAL", "format": "TIMESTAMP", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_37ed413f-c97d-4b74-9d8b-09c14871d74b", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "TIMESTAMP", "sourceType": "TIMESTAMP", "sourceName": "start_time", "targetNames": [ "START_DATE_TIME" ], "hint": "start_time", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_start_time", "i18nLabel": "start_time" }, "category": "MINIMAL", "format": "TIMESTAMP", "enumerated": false, "isId": false, "optimize": true, "updatable": false, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_e81e748b-b286-4170-99c6-9d6fe5f24dab", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false }, { "type": "TIMESTAMP", "sourceType": "VARCHAR", "sourceName": "update_time", "targetNames": [ "LAST_UPDATE_DATE_TIME" ], "hint": "update_time", "label": { "group": "Fitnesse", "key": "ICAWeather_Fitnesse_update_time", "i18nLabel": "update_time" }, "category": "MINIMAL", "format": "TIMESTAMP", "enumerated": false, "isId": false, "optimize": false, "updatable": true, "metric": false, "chart": false, "hidden": false, "ordinal": 0, "hover": false, "previewCard": true, "helpMessage": { "group": "Fitnesse", "key": "i18n_0f4e184f-39c6-4621-a1c4-80ff1dc350eb", "i18nLabel": "" }, "userFilterInput": false, "displayedonMap": false } ], "geometry": "POINT", "routingLogic": "AND", "styleLogic": "AND", "archive": 1, "boundary": false, "boundaryFilterPane": false, "correlation": false, "report": false, "table": "IOC.TARGET_TABLE_${TT_NAME_ICA_WEATHER}", "view": "IOC.TARGET_VIEW_${TT_NAME_ICA_WEATHER}", "serverRendering": false, "nonTrustedSource": false, "comments": false, "voting": false, "imageUploads": false, "icon": "weatherCondition.png", "radius": 0, "sides": 0, "styles": [ { "name": "_base_", "label": {}, "type": "COLOR", "line": "#000000", "value": "#d3d3d3", "weight": 1, "opacity": 1, "scope": "DATASOURCE" } ], "extensions": [ { "name": "category", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "1" }, { "name": "dimension", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" }, { "name": "name", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "weather_ica" }, { "name": "resource", "label": {}, "type": "CUSTOM", "disabled": false, "multiple": false, "module": "ICPO", "associated": "false" } ], "optionalDateTime": false, "minZoomForLoad": 0 } | | 200 | | $DSID_ICAWEATHER= | | |
| GET | /datasource-service/datasources/$DSID_ICAWEATHER | | | 200 | =~/(?i)"Name":"${DS_NAME_ICA_WEATHER}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 30000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? | getFirstResultField? |
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_ICA_WEATHER} | json | | 1 | OK | >0 |
