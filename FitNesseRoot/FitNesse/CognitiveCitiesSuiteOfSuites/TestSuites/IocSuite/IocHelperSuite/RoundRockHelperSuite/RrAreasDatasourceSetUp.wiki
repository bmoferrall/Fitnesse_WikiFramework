---
Help: Set up Round Rock Areas data source
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables


'''CREATE CSV DATASOURCES'''

'''Copy source csv to app server '''

|script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|remote file copy;|./testfiles/roundrock/${CSV_NAME_RR_AREAS}|/opt/IBM/ioc/csv/${CSV_NAME_RR_AREAS}|${APPSERVER}|${APPSERVERUSER}|${APPSERVERKEYFILE}|${APPSERVERKEYPWD}|

'''Create CSV type data source '''

|generic service validator fixture                                                                                                                                                  |
|requestType|serviceName                                                                                               |requestBody|customHeaders|getResponseCode?|getResponseMessage?|getResponseId?|getResultCount?|getUrl?|
|POST        |/datasource-service/datasources/     | { "name":"${DS_NAME_RR_AREAS}", "type":"CSV", "scope":"DATASOURCE", "label":{ "group":"Sample", "key":"roundRockAreas", "i18nLabel":"Areas", "resources":[ { "id":77647, "group":"Sample", "locale":"en", "key":"roundRockAreas", "value":"Areas" } ] }, "i18nLabel":"Areas", "description":{ }, "receiver":{ "type":"com.ibm.ioc.datareceiver.types.DataReceiverCSV", "interval":0, "unit":"MINUTES", "started":true }, "source":{ "protocol":"com.ibm.ioc.datasource.ColumnParserCsv", "port":0, "directory":"/opt/IBM/ioc/csv/", "filename":"${CSV_NAME_RR_AREAS}", "persistData":true }, "columns":[ { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"0", "targetNames":[ "NAME" ], "hint":"Name", "label":{ "group":"DataSourceI18n", "key":"fef62943-85c7-4bca-b360-55d5696452cc", "i18nLabel":"Name", "resources":[ { "id":77654, "lastUpdateDate":1533688210517, "group":"DataSourceI18n", "locale":"en", "key":"fef62943-85c7-4bca-b360-55d5696452cc", "value":"Name" } ] }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"9050672d-b2e3-4356-83d6-89f8904d5deb", "i18nLabel":"", "resources":[ { "id":77655, "lastUpdateDate":1533688210522, "group":"DataSourceI18n", "locale":"en", "key":"9050672d-b2e3-4356-83d6-89f8904d5deb", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"1", "targetNames":[ "LOCATION" ], "hint":"Location", "label":{ "group":"DataSourceI18n", "key":"5575fb12-5f0b-4093-bd18-8c71812e9cdc", "i18nLabel":"Location", "resources":[ { "id":77652, "lastUpdateDate":1533688210507, "group":"DataSourceI18n", "locale":"en", "key":"5575fb12-5f0b-4093-bd18-8c71812e9cdc", "value":"Location" } ] }, "category":"MINIMAL", "format":"SHAPE", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"3921d243-f64c-41a9-ad26-162d624382a2", "i18nLabel":"", "resources":[ { "id":77653, "lastUpdateDate":1533688210512, "group":"DataSourceI18n", "locale":"en", "key":"3921d243-f64c-41a9-ad26-162d624382a2", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"2", "targetNames":[ "START_DATE_TIME" ], "hint":"StartDateTime", "label":{ "group":"DataSourceI18n", "key":"6ba425ff-d111-424e-afb3-fa47af0b1a67", "i18nLabel":"StartDateTime", "resources":[ { "id":77656, "lastUpdateDate":1533688210527, "group":"DataSourceI18n", "locale":"en", "key":"6ba425ff-d111-424e-afb3-fa47af0b1a67", "value":"StartDateTime" } ] }, "category":"MINIMAL", "format":"TIMESTAMP", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"800eb7ff-bf61-4227-a7a5-62259b26c021", "i18nLabel":"", "resources":[ { "id":77657, "lastUpdateDate":1533688210530, "group":"DataSourceI18n", "locale":"en", "key":"800eb7ff-bf61-4227-a7a5-62259b26c021", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"3", "targetNames":[ "END_DATE_TIME" ], "hint":"EndDateTime", "label":{ "group":"DataSourceI18n", "key":"1b5f4223-91c8-4ebb-8c6a-6750f4b1efde", "i18nLabel":"EndDateTime", "resources":[ { "id":77648, "lastUpdateDate":1533688210493, "group":"DataSourceI18n", "locale":"en", "key":"1b5f4223-91c8-4ebb-8c6a-6750f4b1efde", "value":"EndDateTime" } ] }, "category":"MINIMAL", "format":"TIMESTAMP", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"5b6e64ee-a617-459b-ae5d-96f21ba63389", "i18nLabel":"", "resources":[ { "id":77649, "lastUpdateDate":1533688210496, "group":"DataSourceI18n", "locale":"en", "key":"5b6e64ee-a617-459b-ae5d-96f21ba63389", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"4", "targetNames":[ "LAST_UPDATE_DATE_TIME" ], "hint":"LastUpdateDateTime", "label":{ "group":"DataSourceI18n", "key":"d52b4fc0-0276-4fe4-a092-7c7267f8ef40", "i18nLabel":"LastUpdateDateTime", "resources":[ { "id":77650, "lastUpdateDate":1533688210499, "group":"DataSourceI18n", "locale":"en", "key":"d52b4fc0-0276-4fe4-a092-7c7267f8ef40", "value":"LastUpdateDateTime" } ] }, "category":"MINIMAL", "format":"TIMESTAMP", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"634a5dd4-b7bc-49c0-a348-79ca3f6b6e4c", "i18nLabel":"", "resources":[ { "id":77651, "lastUpdateDate":1533688210503, "group":"DataSourceI18n", "locale":"en", "key":"634a5dd4-b7bc-49c0-a348-79ca3f6b6e4c", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false }, { "type":"INTEGER", "sourceType":"VARCHAR", "sourceName":"5", "targetNames":[ "TIMEZONE_OFFSET" ], "hint":"TimeZoneOffset", "label":{ "group":"DataSourceI18n", "key":"bb0472b1-7d91-4274-b073-a875d85a816d", "i18nLabel":"TimeZoneOffset", "resources":[ { "id":77658, "lastUpdateDate":1533688210537, "group":"DataSourceI18n", "locale":"en", "key":"bb0472b1-7d91-4274-b073-a875d85a816d", "value":"TimeZoneOffset" } ] }, "category":"MINIMAL", "format":"INTEGER", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"65469390-64d9-4f70-b4b5-58db43552d29", "i18nLabel":"", "resources":[ { "id":77659, "lastUpdateDate":1533688210543, "group":"DataSourceI18n", "locale":"en", "key":"65469390-64d9-4f70-b4b5-58db43552d29", "value":"" } ] }, "userFilterInput":false, "displayedonMap":false } ], "geometry":"POLYGON", "routingLogic":"AND", "styleLogic":"AND", "archive":1, "boundary":true, "boundaryFilterPane":false, "correlation":false, "report":false, "table":"IOC.TARGET_TABLE_${TT_NAME_RR_AREAS}", "view":"IOC.TARGET_VIEW_${TT_NAME_RR_AREAS}", "serverRendering":false, "nonTrustedSource":false, "comments":false, "voting":false, "imageUploads":false, "icon":"CBRNE.png", "radius":0.0, "sides":0, "styles":[ { "name":"_base_", "label":{ }, "type":"COLOR", "line":"#000000", "value":"#d3d3d3", "weight":1, "opacity":1.0, "scope":"DATASOURCE" } ], "extensions":[ { "name":"category", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"1" }, { "name":"dimension", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" }, { "name":"name", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"RRAreas" }, { "name":"resource", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" } ], "optionalDateTime":true, "minZoomForLoad":0 }       ||200||$DSID_RRAREAS=|||
|GET        |/datasource-service/datasources/$DSID_RRAREAS |||200             |=~/(?i)"Name":"${DS_NAME_RR_AREAS}"/||1||

|script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|#''Give data receiver time to receive records''|
|time delay ;|10000|

'''Verify the target table has two records'''

|generic database fixture                                                                                                                                                                                                        |
|# comment|connectionName|statementType|statementText                                                                                                       |responseFormat|getResponse?               |getResultCount?|getResponseMessage?|
|Verify the target table has two records|iocdata           |read         |select count as count from ioc.TARGET_TABLE_${TT_NAME_RR_AREAS}      |json          |[{"COUNT":4}]              |1              |OK                 |
