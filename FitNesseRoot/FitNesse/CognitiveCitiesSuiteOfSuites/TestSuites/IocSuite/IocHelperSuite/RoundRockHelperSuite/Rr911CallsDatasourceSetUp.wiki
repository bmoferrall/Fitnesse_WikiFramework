---
Help: Set up Round Rock 911 Calls data source
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar
'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables
'''CREATE CSV DATASOURCES'''

'''Copy source csv to app server '''

| script |
| remote file copy; | ./testfiles/roundrock/${CSV_NAME_RR_911} | /opt/IBM/ioc/csv/${CSV_NAME_RR_911} | ${APPSERVER} | ${APPSERVERUSER} | ${APPSERVERKEYFILE} | ${APPSERVERKEYPWD} |

'''Create CSV type data source '''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name":"${DS_NAME_RR_911}", "type":"CSV", "scope":"DATASOURCE", "label":{ "group":"DataSourceI18n", "key":"911Calls", "i18nLabel":"911 Calls", "resources":[ { "id": 77555, "group":"DataSourceI18n", "locale":"en", "key":"911Calls", "value":"911 Police Calls" } ] }, "i18nLabel":"911 Calls", "description":{ "group":"DataSourceI18n", "key":"i18n_36378140-a510-4cd2-85d3-72555c1c64e3", "i18nLabel":"" }, "receiver":{ "type":"com.ibm.ioc.datareceiver.types.DataReceiverCSV", "interval":1, "unit":"MINUTES", "started":true }, "source":{ "protocol":"com.ibm.ioc.datasource.ColumnParserCsv", "port":0, "directory":"/opt/IBM/ioc/csv/", "filename":"${CSV_NAME_RR_911}", "persistData":true }, "columns":[ { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"0", "targetNames":[ "NAME" ], "hint":"master_incident_number", "label":{ "group":"DataSourceI18n", "key":"3de71f71-8cf7-41b5-bdfb-f74cc993ab11", "i18nLabel":"master_incident_number" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":true, "optimize":true, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"eea5e60a-decc-4edf-a4ff-17d37f572e63", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"1", "targetNames":[ "RESPONSE_DATE" ], "hint":"response_date", "label":{ "group":"DataSourceI18n", "key":"637c81ee-00fe-4887-9c18-1823f12299ae", "i18nLabel":"response_date" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"60ffdaa6-bb84-453e-8b4e-cf31b54e3652", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"2", "targetNames":[ "START" ], "hint":"StartDate", "label":{ "group":"DataSourceI18n", "key":"13bb1a39-d79d-4520-8d77-08373a0c9019", "i18nLabel":"StartDate" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"baf339c2-962b-48f8-9cd4-6247281b8747", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"3", "targetNames":[ "END" ], "hint":"EndDate", "label":{ "group":"DataSourceI18n", "key":"5b4e6214-42a3-4b6c-8341-04ae84ce33fd", "i18nLabel":"EndDate" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"2027f8b4-3275-4c34-85c5-1f6b01911234", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"4", "targetNames":[ "PROBLEM" ], "hint":"problem", "label":{ "group":"DataSourceI18n", "key":"d4094a64-895e-4b27-84d3-e178d2cf3292", "i18nLabel":"problem" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"8965246b-efdf-44fe-aa49-9fc5fdb3b6f1", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"5", "targetNames":[ "CALL_DISPOSITION" ], "hint":"call_disposition", "label":{ "group":"DataSourceI18n", "key":"fb40763d-347d-460e-92e3-049c5621524e", "i18nLabel":"call_disposition" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"f739c450-89c8-404b-9795-f02fde5a6549", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"6", "targetNames":[ "PRIORITY_NUMBER" ], "hint":"priority_number", "label":{ "group":"DataSourceI18n", "key":"44d15a18-1e42-4b34-9538-36c75a450226", "i18nLabel":"priority_number" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"8fc935ad-e2ac-45c3-809d-2be8d7e550a1", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"7", "targetNames":[ "LAST_UPDATE_DATE_TIME" ], "hint":"LastUpdateDate", "label":{ "group":"DataSourceI18n", "key":"7a007595-0ede-4c90-9699-e91771489aba", "i18nLabel":"LastUpdateDate" }, "category":"MINIMAL", "format":"TIMESTAMP", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"bbd9e505-42bb-41e1-b135-5c335b3acc28", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"8", "targetNames":[ "LATITUDE" ], "hint":"latitude", "label":{ "group":"DataSourceI18n", "key":"d9c069e5-8749-4f7a-a707-be8515e2cb10", "i18nLabel":"latitude" }, "category":"MINIMAL", "format":"LAT_LON", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"d62475dc-e5ff-443b-b581-ea8a15cb458d", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"9", "targetNames":[ "LONGITUDE" ], "hint":"longitude", "label":{ "group":"DataSourceI18n", "key":"270d91bd-bfa7-4b21-b7ac-e6b7aac5b02a", "i18nLabel":"longitude" }, "category":"MINIMAL", "format":"LAT_LON", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"DataSourceI18n", "key":"adf7b3ff-368e-4d91-9052-119cbace3f19", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false } ], "geometry":"POINT", "dateFormat":"MMM dd yyyy", "timeFormat":"hh:mma", "routingLogic":"AND", "archive":0, "boundary":false, "boundaryFilterPane":false, "correlation":false, "report":false, "table":"IOC.TARGET_TABLE_${TT_NAME_RR_911}", "view":"IOC.TARGET_VIEW_${TT_NAME_RR_911}", "serverRendering":false, "nonTrustedSource":false, "comments":false, "voting":false, "imageUploads":false, "icon":"311.png", "radius":0.0, "sides":0, "styles":[ { "name":"_base_", "label":{ }, "type":"COLOR", "line":"#000000", "value":"#d3d3d3", "weight":1, "opacity":1.0, "scope":"DATASOURCE" } ], "extensions":[ { "name":"category", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"1" }, { "name":"dimension", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" }, { "name":"name", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"911_calls" }, { "name":"resource", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" } ], "optionalDateTime":false, "minZoomForLoad":0 } | | 200 | | $DSID_RR911CALLS= | | |
| GET | /datasource-service/datasources/$DSID_RR911CALLS | | | 200 | =~/(?i)"Name":"${DS_NAME_RR_911}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 10000 |

'''Verify the target table has two records'''

| generic database fixture |
| # comment | connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |
| Verify the target table has two records | iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_RR_911} | json | [{"COUNT":5000}] | 1 | OK |
