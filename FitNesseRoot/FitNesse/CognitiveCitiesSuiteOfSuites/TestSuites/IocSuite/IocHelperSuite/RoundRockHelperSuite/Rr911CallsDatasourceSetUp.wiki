---
Help: Set up Round Rock 911 Calls data source
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables

'''CREATE CSV DATASOURCES'''

'''Copy source csv to app server '''

| script |
| remote file copy; | ./testfiles/roundrock/${CSV_NAME_RR_911} | /opt/IBM/ioc/csv/${CSV_NAME_RR_911} | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |

'''Create i18n resources for the data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_DsLabel", "value":"911 Calls (Fitnesse)","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_master_incident_number", "value":"master_incident_number","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_master_response_date", "value":"response_date","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_master_StartDate", "value":"StartDate","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_master_EndDate", "value":"EndDate","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_problem", "value":"problem","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_call_disposition", "value":"call_disposition","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_priority_number", "value":"priority_number","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_LastUpdateDate", "value":"LastUpdateDate","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_latitude", "value":"latitude","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RR911_Fitnesse_longitude", "value":"longitude","messages": []}|||||||

'''Create CSV type data source '''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | { "name":"${DS_NAME_RR_911}", "type":"CSV", "scope":"DATASOURCE", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_DsLabel", "i18nLabel":"911 Calls (Fitnesse)", "resources":[ { "group":"Fitnesse", "locale":"en", "key":"RR911_Fitnesse_DsLabel", "value":"911 Calls (Fitnesse)" } ] }, "i18nLabel":"911 Calls (Fitnesse)", "description":{ "group":"Fitnesse", "key":"i18n_36378140-a510-4cd2-85d3-72555c1c64e3", "i18nLabel":"" }, "receiver":{ "type":"com.ibm.ioc.datareceiver.types.DataReceiverCSV", "interval":1, "unit":"MINUTES", "started":true }, "source":{ "protocol":"com.ibm.ioc.datasource.ColumnParserCsv", "port":0, "directory":"/opt/IBM/ioc/csv/", "filename":"${CSV_NAME_RR_911}", "persistData":true }, "columns":[ { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"0", "targetNames":[ "NAME" ], "hint":"master_incident_number", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_master_incident_number", "i18nLabel":"master_incident_number" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":true, "optimize":true, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"eea5e60a-decc-4edf-a4ff-17d37f572e63", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"1", "targetNames":[ "RESPONSE_DATE" ], "hint":"response_date", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_master_response_date", "i18nLabel":"response_date" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"60ffdaa6-bb84-453e-8b4e-cf31b54e3652", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"2", "targetNames":[ "START" ], "hint":"StartDate", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_master_StartDate", "i18nLabel":"StartDate" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"baf339c2-962b-48f8-9cd4-6247281b8747", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"3", "targetNames":[ "END" ], "hint":"EndDate", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_master_EndDate", "i18nLabel":"EndDate" }, "category":"MINIMAL", "format":"STRING", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"2027f8b4-3275-4c34-85c5-1f6b01911234", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"4", "targetNames":[ "PROBLEM" ], "hint":"problem", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_problem", "i18nLabel":"problem" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"8965246b-efdf-44fe-aa49-9fc5fdb3b6f1", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"5", "targetNames":[ "CALL_DISPOSITION" ], "hint":"call_disposition", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_call_disposition", "i18nLabel":"call_disposition" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"f739c450-89c8-404b-9795-f02fde5a6549", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"6", "targetNames":[ "PRIORITY_NUMBER" ], "hint":"priority_number", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_priority_number", "i18nLabel":"priority_number" }, "category":"FULL", "length":"200", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"8fc935ad-e2ac-45c3-809d-2be8d7e550a1", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"TIMESTAMP", "sourceType":"VARCHAR", "sourceName":"7", "targetNames":[ "LAST_UPDATE_DATE_TIME" ], "hint":"LastUpdateDate", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_LastUpdateDate", "i18nLabel":"LastUpdateDate" }, "category":"MINIMAL", "format":"TIMESTAMP", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"bbd9e505-42bb-41e1-b135-5c335b3acc28", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"8", "targetNames":[ "LATITUDE" ], "hint":"latitude", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_latitude", "i18nLabel":"latitude" }, "category":"MINIMAL", "format":"LAT_LON", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"d62475dc-e5ff-443b-b581-ea8a15cb458d", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false }, { "type":"VARCHAR", "sourceType":"VARCHAR", "sourceName":"9", "targetNames":[ "LONGITUDE" ], "hint":"longitude", "label":{ "group":"Fitnesse", "key":"RR911_Fitnesse_longitude", "i18nLabel":"longitude" }, "category":"MINIMAL", "format":"LAT_LON", "enumerated":false, "isId":false, "optimize":false, "updatable":true, "metric":false, "chart":false, "hidden":false, "ordinal":0, "hover":false, "previewCard":true, "helpMessage":{ "group":"Fitnesse", "key":"adf7b3ff-368e-4d91-9052-119cbace3f19", "i18nLabel":"" }, "userFilterInput":false, "displayedonMap":false } ], "geometry":"POINT", "dateFormat":"MMM dd yyyy", "timeFormat":"hh:mma", "routingLogic":"AND", "archive":0, "boundary":false, "boundaryFilterPane":false, "correlation":false, "report":false, "table":"IOC.TARGET_TABLE_${TT_NAME_RR_911}", "view":"IOC.TARGET_VIEW_${TT_NAME_RR_911}", "serverRendering":false, "nonTrustedSource":false, "comments":false, "voting":false, "imageUploads":false, "icon":"311.png", "radius":0.0, "sides":0, "styles":[ { "name":"_base_", "label":{ }, "type":"COLOR", "line":"#000000", "value":"#d3d3d3", "weight":1, "opacity":1.0, "scope":"DATASOURCE" } ], "extensions":[ { "name":"category", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"1" }, { "name":"dimension", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" }, { "name":"name", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"911_calls" }, { "name":"resource", "label":{ }, "type":"CUSTOM", "disabled":false, "multiple":false, "module":"ICPO", "associated":"false" } ], "optionalDateTime":false, "minZoomForLoad":0 } | | 200 | | $DSID_RR911CALLS= | | |
| GET | /datasource-service/datasources/$DSID_RR911CALLS | | | 200 | =~/(?i)"Name":"${DS_NAME_RR_911}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 10000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |getFirstResultField?|
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_RR_911} | json | [{"COUNT":5000}] | 1 | OK |5000|
