---
Help: Set up Round Rock Bus Stops data source
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables

'''CREATE CSV DATASOURCES'''

'''Copy source csv to app server '''

| script |
| remote file copy; | ./testfiles/roundrock/${CSV_NAME_RR_BUS_STOPS} | /opt/IBM/ioc/csv/${CSV_NAME_RR_BUS_STOPS} | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |

'''Create i18n resources for the data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_DsLabel", "value":"Bus Stops (Fitnesse)","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_NAME", "value":"NAME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_LONGITUDE", "value":"LONGITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_LATITUDE", "value":"LATITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_START_TIME", "value":"START_TIME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_START_DATE", "value":"START_DATE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_END_TIME", "value":"END_TIME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRBusStops_Fitnesse_END_DATE", "value":"END_DATE","messages": []}|||||||

'''Create CSV type data source '''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | {"name":"${DS_NAME_RR_BUS_STOPS}","lastUpdateDate":1553559307119,"type":"CSV","scope":"DATASOURCE","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_DsLabel","i18nLabel":"Bus Stops (Fitnesse)","resources":[{"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_DsLabel","value":"Bus Stops (Fitnesse)"}]},"i18nLabel":"Bus Stops (Fitnesse)","description":{"group":"Fitnesse","key":"i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31","i18nLabel":"","resources":[{"id":82344,"lastUpdateDate":1553559410565,"group":"Fitnesse","locale":"en","key":"i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31","value":""}]},"receiver":{"type":"com.ibm.ioc.datareceiver.types.DataReceiverCSV","interval":1,"unit":"MINUTES","started":true},"source":{"protocol":"com.ibm.ioc.datasource.ColumnParserCsv","port":0,"directory":"/opt/IBM/ioc/csv/","filename":"${CSV_NAME_RR_BUS_STOPS}","persistData":true},"columns":[{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"0","targetNames":["NAME"],"hint":"NAME","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_NAME","i18nLabel":"NAME","resources":[{"id":82215,"lastUpdateDate":1553559307049,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_NAME","value":"NAME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_1e8d7330-b866-456b-8fab-249182175930","i18nLabel":"","resources":[{"id":82216,"lastUpdateDate":1553559307053,"group":"Fitnesse","locale":"en","key":"i18n_1e8d7330-b866-456b-8fab-249182175930","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"1","targetNames":["LONGITUDE"],"hint":"LONGITUDE","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_LONGITUDE","i18nLabel":"LONGITUDE","resources":[{"id":82213,"lastUpdateDate":1553559307041,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_LONGITUDE","value":"LONGITUDE"}]},"category":"MINIMAL","format":"LAT_LON","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_92a40e2e-8004-4891-bc51-571ba3834c69","i18nLabel":"","resources":[{"id":82214,"lastUpdateDate":1553559307045,"group":"Fitnesse","locale":"en","key":"i18n_92a40e2e-8004-4891-bc51-571ba3834c69","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"2","targetNames":["LATITUDE"],"hint":"LATITUDE","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_LATITUDE","i18nLabel":"LATITUDE","resources":[{"id":82211,"lastUpdateDate":1553559307033,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_LATITUDE","value":"LATITUDE"}]},"category":"MINIMAL","format":"LAT_LON","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_8f7d057c-7dbb-4f9f-9339-aa90e709d169","i18nLabel":"","resources":[{"id":82212,"lastUpdateDate":1553559307037,"group":"Fitnesse","locale":"en","key":"i18n_8f7d057c-7dbb-4f9f-9339-aa90e709d169","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"3","targetNames":["START_TIME"],"hint":"START_TIME","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_START_TIME","i18nLabel":"START_TIME","resources":[{"id":82219,"lastUpdateDate":1553559307062,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_START_TIME","value":"START_TIME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_1556de0e-8758-4c17-bf36-0885ec79e0e3","i18nLabel":"","resources":[{"id":82220,"lastUpdateDate":1553559307066,"group":"Fitnesse","locale":"en","key":"i18n_1556de0e-8758-4c17-bf36-0885ec79e0e3","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"4","targetNames":["START_DATE"],"hint":"START_DATE","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_START_DATE","i18nLabel":"START_DATE","resources":[{"id":82217,"lastUpdateDate":1553559307056,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_START_DATE","value":"START_DATE"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_c8472ed8-90b6-4d0a-b7f7-a772f89bebed","i18nLabel":"","resources":[{"id":82218,"lastUpdateDate":1553559307059,"group":"Fitnesse","locale":"en","key":"i18n_c8472ed8-90b6-4d0a-b7f7-a772f89bebed","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"5","targetNames":["END_TIME"],"hint":"END_TIME","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_END_TIME","i18nLabel":"END_TIME","resources":[{"id":82209,"lastUpdateDate":1553559307025,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_END_TIME","value":"END_TIME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_d96dc9ea-e916-4fa9-b7c5-d48c0eccbe3d","i18nLabel":"","resources":[{"id":82210,"lastUpdateDate":1553559307029,"group":"Fitnesse","locale":"en","key":"i18n_d96dc9ea-e916-4fa9-b7c5-d48c0eccbe3d","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"6","targetNames":["END_DATE"],"hint":"END_DATE","label":{"group":"Fitnesse","key":"RRBusStops_Fitnesse_END_DATE","i18nLabel":"END_DATE","resources":[{"id":82207,"lastUpdateDate":1553559307017,"group":"Fitnesse","locale":"en","key":"RRBusStops_Fitnesse_END_DATE","value":"END_DATE"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_c33094b4-202c-45d7-8eb2-18845aca1d25","i18nLabel":"","resources":[{"id":82208,"lastUpdateDate":1553559307021,"group":"Fitnesse","locale":"en","key":"i18n_c33094b4-202c-45d7-8eb2-18845aca1d25","value":""}]},"userFilterInput":false,"displayedonMap":false}],"geometry":"POINT","dateFormat":"MM/dd/yyyy","timeFormat":"hh:mm:ss a","routingLogic":"AND","styleLogic":"AND","archive":1,"boundary":false,"boundaryFilterPane":false,"correlation":false,"report":false,"table":"IOC.TARGET_TABLE_${TT_NAME_RR_BUS_STOPS}","view":"IOC.TARGET_VIEW_${TT_NAME_RR_BUS_STOPS}","serverRendering":false,"nonTrustedSource":false,"comments":false,"voting":false,"imageUploads":false,"icon":"vehicles.png","radius":0.0,"sides":0,"styles":[{"name":"_base_","label":{},"type":"COLOR","line":"#000000","value":"#d3d3d3","weight":1,"opacity":1.0,"scope":"DATASOURCE"}],"extensions":[{"name":"category","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"1"},{"name":"dimension","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"false"},{"name":"name","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"RRBusStops"},{"name":"resource","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"false"}],"optionalDateTime":true,"minZoomForLoad":0} | | 200 | | $DSID_RRBUSSTOPS= | | |
| GET | /datasource-service/datasources/$DSID_RRBUSSTOPS | | | 200 | =~/(?i)"Name":"${DS_NAME_RR_BUS_STOPS}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 10000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |getFirstResultField?|
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_RR_BUS_STOPS} | json | [{"COUNT":4}] | 1 | OK |4|
