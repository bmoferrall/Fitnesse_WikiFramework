---
Help: Set up Round Rock Liquour Sellers data source
Test
---
<test page>

!define TEST_SYSTEM {slim}
!path   ./CognitiveCitiesTesting.jar

'''Include Variable Definitions'''

!include <IocSuite.IocServicesSuite.SetUpVariables

'''CREATE CSV DATASOURCES'''

'''Copy source csv to app server '''

| script |
| remote file copy; | ./testfiles/roundrock/${CSV_NAME_RR_LSELLERS} | /opt/IBM/ioc/csv/${CSV_NAME_RR_LSELLERS} | ${APPSERVER} | ${SSHUSER} | ${PRIVATEKEYFILE} | ${PRIVATEKEYPWD} |

'''Create i18n resources for the data source'''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_DsLabel", "value":"Liquour Sellers (Fitnesse)","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_NAME", "value":"NAME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_LONGITUDE", "value":"LONGITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_LATITUDE", "value":"LATITUDE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_START_TIME", "value":"START_TIME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_START_DATE", "value":"START_DATE","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_END_TIME", "value":"END_TIME","messages": []}|||||||
|POST|/i18n-service/resources|{"group": "Fitnesse", "locale":"en", "key":"RRLiquourSellers_Fitnesse_END_DATE", "value":"END_DATE","messages": []}|||||||

'''Create CSV type data source '''

| generic service validator fixture |
| requestType | serviceName | requestBody | customHeaders | getResponseCode? | getResponseMessage? | getResponseId? | getResultCount? | getUrl? |
| POST | /datasource-service/datasources/ | {"name":"${DS_NAME_RR_LSELLERS}","lastUpdateDate":1553559377549,"type":"CSV","scope":"Fitnesse","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_DsLabel","i18nLabel":"Liquour Sellers (Fitnesse)","resources":[{"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_DsLabel","value":"Liquour Sellers (Fitnesse)"}]},"i18nLabel":"Liquor Sellers (Fitnesse)","description":{"group":"Fitnesse","key":"i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31","i18nLabel":"","resources":[{"id":82344,"lastUpdateDate":1553559410565,"group":"Fitnesse","locale":"en","key":"i18n_8c007b2f-2cfb-45d4-8969-84b3cd082c31","value":""}]},"receiver":{"type":"com.ibm.ioc.datareceiver.types.DataReceiverCSV","interval":1,"unit":"MINUTES","started":true},"source":{"protocol":"com.ibm.ioc.datasource.ColumnParserCsv","port":0,"directory":"/opt/IBM/ioc/csv/","filename":"${CSV_NAME_RR_LSELLERS}","persistData":true},"columns":[{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"0","targetNames":["NAME"],"hint":"NAME","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_NAME","i18nLabel":"NAME","resources":[{"id":82299,"lastUpdateDate":1553559377465,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_NAME","value":"NAME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_3fb89fd2-b93a-4007-a236-418a2cbd6857","i18nLabel":"","resources":[{"id":82300,"lastUpdateDate":1553559377468,"group":"Fitnesse","locale":"en","key":"i18n_3fb89fd2-b93a-4007-a236-418a2cbd6857","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"1","targetNames":["LONGITUDE"],"hint":"LONGITUDE","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_LONGITUDE","i18nLabel":"LONGITUDE","resources":[{"id":82297,"lastUpdateDate":1553559377459,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_LONGITUDE","value":"LONGITUDE"}]},"category":"MINIMAL","format":"LAT_LON","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_50de4d58-cda1-4ba8-b519-da9f94a59944","i18nLabel":"","resources":[{"id":82298,"lastUpdateDate":1553559377463,"group":"Fitnesse","locale":"en","key":"i18n_50de4d58-cda1-4ba8-b519-da9f94a59944","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"VARCHAR","sourceType":"VARCHAR","sourceName":"2","targetNames":["LATITUDE"],"hint":"LATITUDE","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_LATITUDE","i18nLabel":"LATITUDE","resources":[{"id":82295,"lastUpdateDate":1553559377453,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_LATITUDE","value":"LATITUDE"}]},"category":"MINIMAL","format":"LAT_LON","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_3e2dc43f-de0e-4447-a3ab-9fa8f6cbafe8","i18nLabel":"","resources":[{"id":82296,"lastUpdateDate":1553559377456,"group":"Fitnesse","locale":"en","key":"i18n_3e2dc43f-de0e-4447-a3ab-9fa8f6cbafe8","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"3","targetNames":["START_TIME"],"hint":"START_TIME","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_START_TIME","i18nLabel":"START_TIME","resources":[{"id":82303,"lastUpdateDate":1553559377477,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_START_TIME","value":"START_TIME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_347e1f10-0578-4d4a-b634-5cb50afdb668","i18nLabel":"","resources":[{"id":82304,"lastUpdateDate":1553559377480,"group":"Fitnesse","locale":"en","key":"i18n_347e1f10-0578-4d4a-b634-5cb50afdb668","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"4","targetNames":["START_DATE"],"hint":"START_DATE","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_START_DATE","i18nLabel":"START_DATE","resources":[{"id":82301,"lastUpdateDate":1553559377471,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_START_DATE","value":"START_DATE"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_c00a72bb-f925-4be4-a0fc-8ef875c0c0a4","i18nLabel":"","resources":[{"id":82302,"lastUpdateDate":1553559377474,"group":"Fitnesse","locale":"en","key":"i18n_c00a72bb-f925-4be4-a0fc-8ef875c0c0a4","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"5","targetNames":["END_TIME"],"hint":"END_TIME","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_END_TIME","i18nLabel":"END_TIME","resources":[{"id":82293,"lastUpdateDate":1553559377447,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_END_TIME","value":"END_TIME"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_5203b1c5-28c0-4d44-b014-5495c08a406f","i18nLabel":"","resources":[{"id":82294,"lastUpdateDate":1553559377450,"group":"Fitnesse","locale":"en","key":"i18n_5203b1c5-28c0-4d44-b014-5495c08a406f","value":""}]},"userFilterInput":false,"displayedonMap":false},{"type":"TIMESTAMP","sourceType":"VARCHAR","sourceName":"6","targetNames":["END_DATE"],"hint":"END_DATE","label":{"group":"Fitnesse","key":"RRLiquourSellers_Fitnesse_END_DATE","i18nLabel":"END_DATE","resources":[{"id":82291,"lastUpdateDate":1553559377442,"group":"Fitnesse","locale":"en","key":"RRLiquourSellers_Fitnesse_END_DATE","value":"END_DATE"}]},"category":"MINIMAL","format":"STRING","enumerated":false,"isId":false,"optimize":false,"updatable":true,"metric":false,"chart":false,"hidden":false,"ordinal":0,"hover":false,"previewCard":true,"helpMessage":{"group":"Fitnesse","key":"i18n_c3c439bb-c726-4753-843a-fc9b979a89cf","i18nLabel":"","resources":[{"id":82292,"lastUpdateDate":1553559377445,"group":"Fitnesse","locale":"en","key":"i18n_c3c439bb-c726-4753-843a-fc9b979a89cf","value":""}]},"userFilterInput":false,"displayedonMap":false}],"geometry":"POINT","dateFormat":"MM/dd/yyyy","timeFormat":"hh:mm:ss a","routingLogic":"AND","styleLogic":"AND","archive":1,"boundary":false,"boundaryFilterPane":false,"correlation":false,"report":false,"table":"IOC.TARGET_TABLE_${TT_NAME_RR_LSELLERS}","view":"IOC.TARGET_VIEW_${TT_NAME_RR_LSELLERS}","serverRendering":false,"nonTrustedSource":false,"comments":false,"voting":false,"imageUploads":false,"icon":"alcoholConcession.png","radius":0.0,"sides":0,"styles":[{"name":"_base_","label":{},"type":"COLOR","line":"#000000","value":"#d3d3d3","weight":1,"opacity":1.0,"scope":"DATASOURCE"}],"extensions":[{"name":"category","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"1"},{"name":"dimension","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"false"},{"name":"name","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"LiquorSellers"},{"name":"resource","label":{},"type":"CUSTOM","disabled":false,"multiple":false,"module":"ICPO","associated":"false"}],"optionalDateTime":true,"minZoomForLoad":0} | | 200 | | $DSID_RRLSELLERS= | | |
| GET | /datasource-service/datasources/$DSID_RRLSELLERS | | | 200 | =~/(?i)"Name":"${DS_NAME_RR_LSELLERS}"/ | | 1 | |

| script |
| #''Give data receiver time to receive records'' |
| time delay ; | 10000 |

'''Verify the target table has the correct number of records'''

| generic database fixture |
| connectionName | statementType | statementText | responseFormat | getResponse? | getResultCount? | getResponseMessage? |getFirstResultField?|
| iocdata | read | select count as count from ioc.TARGET_TABLE_${TT_NAME_RR_LSELLERS} | json | [{"COUNT":4}] | 1 | OK |4|
